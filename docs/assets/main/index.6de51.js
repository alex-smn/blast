window.__require=function e(t,o,i){function s(a,r){if(!o[a]){if(!t[a]){var l=a.split("/");if(l=l[l.length-1],!t[l]){var c="function"==typeof __require&&__require;if(!r&&c)return c(l,!0);if(n)return n(l,!0);throw new Error("Cannot find module '"+a+"'")}a=l}var u=o[a]={exports:{}};t[a][0].call(u.exports,function(e){return s(t[a][1][e]||e)},u,u.exports,e,t,o,i)}return o[a].exports}for(var n="function"==typeof __require&&__require,a=0;a<i.length;a++)s(i[a]);return s}({BoosterManager:[function(e,t,o){"use strict";cc._RF.push(t,"13502PVb5xEr6Ndr9Lb5j7o","BoosterManager"),o.__esModule=!0,o.default=void 0;var i=r(e("./GameParameters")),s=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=a(void 0);if(t&&t.has(e))return t.get(e);var o={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var n=i?Object.getOwnPropertyDescriptor(e,s):null;n&&(n.get||n.set)?Object.defineProperty(o,s,n):o[s]=e[s]}return o.default=e,t&&t.set(e,o),o}(e("./Booster")),n=r(e("./Field"));function a(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,o=new WeakMap;return(a=function(e){return e?o:t})(e)}function r(e){return e&&e.__esModule?e:{default:e}}var l=cc.Class({extends:cc.Component,properties:{boosters:{default:[],type:[s.default]},field:{default:null,type:n.default},_teleportTileLocation:{default:null,type:Object}},onClick:function(e){var t=this;this.boosters.forEach(function(o){o.checkLocationIsInBounds(e)&&t._toggle(o)})},performBooster:function(e){var t=this.getSelectedBooster(),o=this.field.getTileIndicesFromCoords(e);if(o){var i=this._onTileClickWithBooster(o.col,o.row,t);return i&&this.deselectBooster(t),i}return!1},getSelectedBooster:function(){return this.boosters.find(function(e){return e.isSelected()})},deselectBooster:function(e){e.select(!1)},_onTileClickWithBooster:function(e,t,o){if(this.field.isTileMoving(e,t))return!1;switch(o.boosterType){case s.BoosterType.BOMB:return this._performBomb(e,t);case s.BoosterType.TELEPORT:return this._performTeleport(e,t)}},_performBomb:function(e,t){var o=this._getTileNeighboursInRadius(e,t,i.default.bombRadius);return this.field.blastTiles(o),!0},_performTeleport:function(e,t){return null!=this._teleportTileLocation?(this.field.setTileSelected(this._teleportTileLocation.col,this._teleportTileLocation.row,!1),this.field.swapTiles({col:e,row:t},{col:this._teleportTileLocation.col,row:this._teleportTileLocation.row}),this._teleportTileLocation=null,!0):(this._teleportTileLocation={col:e,row:t},this.field.setTileSelected(e,t,!0),!1)},_getTileNeighboursInRadius:function(e,t,o){for(var s=[],n=e-o;n<=e+o;n++)for(var a=t-o;a<=t+o;a++)n>=0&&n<i.default.columns&&a>=0&&a<i.default.rows&&s.push({col:n,row:a});return s},_toggle:function(e){var t=e.isSelected();this.boosters.forEach(function(e){return e.select(!1)}),e.select(!t)}});o.default=l,t.exports=o.default,cc._RF.pop()},{"./Booster":"Booster","./Field":"Field","./GameParameters":"GameParameters"}],Booster:[function(e,t,o){"use strict";cc._RF.push(t,"bb484lVD8ZF+YAUW8UcIGes","Booster"),o.__esModule=!0,o.default=o.BoosterType=o.BoosterPrice=void 0;var i=Object.freeze({BOMB:0,TELEPORT:1});o.BoosterType=i;var s=Object.freeze({BOMB:1e3,TELEPORT:500});o.BoosterPrice=s;var n=cc.Class({extends:cc.Component,properties:{boosterType:i.BOMB,_price:0,frame:{default:null,type:cc.Sprite},priceLabel:{default:null,type:cc.Label},_isEnabled:!1,_isSelected:!1},onLoad:function(){switch(this.boosterType){case i.BOMB:this._price=s.BOMB;break;case i.TELEPORT:this._price=s.TELEPORT}this.priceLabel.string=this._price},checkLocationIsInBounds:function(e){var t=this.node.convertToNodeSpaceAR(e);return t.x>-this.node.width/2&&t.x<this.node.width/2&&t.y>-this.node.height/2&&t.y<this.node.height/2},select:function(e){e!=this._isSelected&&(this._isSelected=e,this.frame.node.active=e)},setIsEnabled:function(e){this.node.opacity=1==e?255:150,this.node.isEnabled=e},isSelected:function(){return this._isSelected},getPrice:function(){return this._price}});o.default=n,cc._RF.pop()},{}],EffectsManager:[function(e,t,o){"use strict";cc._RF.push(t,"7e94933wqFHjrb+kP/Z8VLh","EffectsManager"),o.__esModule=!0,o.default=void 0;var i=cc.Class({extends:cc.Component,properties:{prefabParticleSystem:{default:null,type:cc.Node}},animateBlast:function(e,t){var o=cc.instantiate(this.prefabParticleSystem);o.parent=this.node;var i=o.getComponent(cc.ParticleSystem);i.startColor=t,i.endColor=t,i.endColor.a=0;var s=this.node.convertToNodeSpaceAR(e);o.setPosition(s)}});o.default=i,t.exports=o.default,cc._RF.pop()},{}],EndMenuManager:[function(e,t,o){"use strict";cc._RF.push(t,"8375aja0lNCSKSak5+tg/Oe","EndMenuManager"),o.__esModule=!0,o.default=o.GameResult=void 0;var i=Object.freeze({VICTORY:0,DEFEAT:1});o.GameResult=i;var s=cc.Class({extends:cc.Component,properties:{resultTitle:{default:null,type:cc.Label},playAgainButton:{default:null,type:cc.Button},mainMenuButton:{default:null,type:cc.Button},_gameResult:i.VICTORY},onLoad:function(){cc.systemEvent.on("result-passed",this.handleResultPassed,this)},handleResultPassed:function(e){this._gameResult=e,this.resultTitle.string=e==i.VICTORY?"\u041f\u043e\u0431\u0435\u0434\u0430":"\u041f\u043e\u0440\u0430\u0436\u0435\u043d\u0438\u0435"},onDestroy:function(){cc.systemEvent.off("data-passed",this.handleResultPassed,this)},onPlayAgainButton:function(){cc.director.loadScene("Game")},onMainMenuButton:function(){cc.director.loadScene("StartMenu")}});o.default=s,cc._RF.pop()},{}],FieldColumn:[function(e,t,o){"use strict";cc._RF.push(t,"2a5bd4J7epMBpMsf/aD47cp","FieldColumn"),o.__esModule=!0,o.default=void 0;var i=a(e("./GameParameters")),s=a(e("./TileFabric")),n=a(e("./Tile"));function a(e){return e&&e.__esModule?e:{default:e}}var r=cc.Class({extends:cc.Component,properties:{_tiles:{default:[],type:[n.default]},tileFabric:{default:null,type:s.default}},startColumn:function(){this._updateTiles()},_updateTiles:function(){for(var e=Math.max.apply(Math,this._tiles.map(function(e){return e.node.position.y})),t=Math.max(i.default.rows*i.default.tileSize.height,e+i.default.tileSize.height),o=0;this._tiles.length<i.default.rows;){var s=this.tileFabric.create();s.parent=this.node,this._tiles.push(s.getComponent(n.default)),s.setPosition(0,t),s.getComponent(n.default).moveDelay=o,t+=i.default.tileSize.height,o+=.1}this.node.width=i.default.tileSize.width,this.node.height=i.default.tileSize.height*this._tiles.length,this._positionTiles()},_positionTiles:function(){this._tiles.forEach(function(e,t){var o=new cc.Vec3(0,t*i.default.tileSize.height);e.moveTo(o)})},getTileColor:function(e){return this._tiles[e].color},blast:function(e){var t=this;e.sort(function(e,t){return t-e}),e.forEach(function(e){t._tiles[e].blast(),t._tiles.splice(e,1)}),this._updateTiles()},isTileMoving:function(e){return this._tiles[e].isMoving},getTiles:function(){return this._tiles},setTiles:function(e){var t=this;this._tiles=e,this._tiles.forEach(function(e){var o=e.node.convertToWorldSpaceAR(new cc.Vec3);e.node.parent=t.node;var i=t.node.convertToNodeSpaceAR(o);e.node.position=i}),this._positionTiles()},setTileSelected:function(e,t){this._tiles[e].node.opacity=t?150:255}});o.default=r,t.exports=o.default,cc._RF.pop()},{"./GameParameters":"GameParameters","./Tile":"Tile","./TileFabric":"TileFabric"}],Field:[function(e,t,o){"use strict";cc._RF.push(t,"d220cOY5IFFxq2iab0nXYZR","Field"),o.__esModule=!0,o.default=void 0;var i=n(e("./GameParameters")),s=n(e("./FieldColumn"));function n(e){return e&&e.__esModule?e:{default:e}}var a=cc.Class({extends:cc.Component,properties:{columnPrefab:{default:null,type:cc.Node},_columns:{default:[],type:[s.default]}},onLoad:function(){for(this.node.width=i.default.columns*i.default.tileSize.width,this.node.height=i.default.rows*i.default.tileSize.height,this.node.setPosition(-this.node.width/2,-this.node.height/2);this._columns.length<i.default.columns;){var e=cc.instantiate(this.columnPrefab);e.parent=this.node,this._columns.push(e.getComponent(s.default))}this._columns.forEach(function(e){return e.startColumn()}),this._positionColumns()},getTileIndicesFromCoords:function(e){var t=this.node.convertToNodeSpaceAR(e),o=Math.floor(t.x/i.default.tileSize.width),s=Math.floor(t.y/i.default.tileSize.height);return o>=0&&o<i.default.columns&&s>=0&&s<i.default.rows?{col:o,row:s}:null},getTileColor:function(e,t){return this._columns[e].getTileColor(t)},hasMovingTiles:function(){for(var e=0;e<i.default.columns;e++)for(var t=0;t<i.default.rows;t++)if(this.isTileMoving(column,t))return!0;return!1},isTileMoving:function(e,t){return this._columns[e].isTileMoving(t)},getTiles:function(){return this._columns.flatMap(function(e){return e.getTiles()})},setTiles:function(e){this._columns.forEach(function(t,o){t.setTiles(e.slice(o*i.default.rows,(o+1)*i.default.rows))})},blastTiles:function(e){this._columns.forEach(function(t,o){var i=e.filter(function(e){return e.col==o});i.length>0&&t.blast(i.map(function(e){return e.row}))})},setTileSelected:function(e,t,o){this._columns[e].setTileSelected(t,o)},swapTiles:function(e,t){if(e.col==t.col){var o=this._columns[e.col].getTiles(),i=[o[t.row],o[e.row]];o[e.row]=i[0],o[t.row]=i[1],this._columns[e.col].setTiles(o)}else{var s=this._columns[e.col].getTiles(),n=this._columns[t.col].getTiles(),a=[n[t.row],s[e.row]];s[e.row]=a[0],n[t.row]=a[1],this._columns[e.col].setTiles(s),this._columns[t.col].setTiles(n)}},_positionColumns:function(){this._columns.forEach(function(e,t){e.node.setPosition(t*i.default.tileSize.width,0)})}});o.default=a,t.exports=o.default,cc._RF.pop()},{"./FieldColumn":"FieldColumn","./GameParameters":"GameParameters"}],GameManager:[function(e,t){"use strict";cc._RF.push(t,"5a1a5CxDb5Cy5TkK77c/BoV","GameManager");var o=l(e("./GameParameters")),i=l(e("./EffectsManager")),s=l(e("./ScoreManager")),n=l(e("./GameMechanicsManager")),a=l(e("./BoosterManager")),r=e("./EndMenuManager");function l(e){return e&&e.__esModule?e:{default:e}}cc.Class({extends:cc.Component,properties:{effectsManager:{default:null,type:i.default},scoreManager:{default:null,type:s.default},gameMechanicsManager:{default:null,type:n.default},boosterManager:{default:null,type:a.default},fieldBackground:{default:null,type:cc.Node},movesLabel:{default:null,type:cc.Label},_moves:0,_shuffleCount:0},onLoad:function(){this.fieldBackground.width=o.default.columns*o.default.tileSize.width+88,this.fieldBackground.height=o.default.rows*o.default.tileSize.height+88,this._moves=o.default.startMovesCount,this._shuffleCount=o.default.shuffleCount,this.node.on(cc.Node.EventType.TOUCH_START,this.onGridTouch,this),this.effectsManager.node.setPosition(-this.gameMechanicsManager.node.width/8,-this.gameMechanicsManager.node.height/8),this.movesLabel.string=this._moves},start:function(){this._checkBoostersState()},onGridTouch:function(e){var t=e.touch.getLocation();if(this.gameMechanicsManager.checkLocationIsInField(t)){var o=this.boosterManager.getSelectedBooster();o?this.boosterManager.performBooster(t)&&this._updateScore(-o.getPrice()):this.gameMechanicsManager.onClick(t)&&this._updateMoves(),this._checkGameState(),this._checkBoostersState()}else this.boosterManager.onClick(t)},_updateMoves:function(){this._moves--,this.movesLabel.string=this._moves},_updateScore:function(e){this.scoreManager.addScore(e)},_checkGameState:function(){this.scoreManager.getCurrentScore()>=o.default.targetPoints&&this._endGame(r.GameResult.VICTORY),0!=this._moves&&this.gameMechanicsManager.canHavePossibleMoves()||this._endGame(r.GameResult.DEFEAT),this.gameMechanicsManager.hasPossibleMoves()||(0==this._shuffleCount?this._endGame(r.GameResult.DEFEAT):(console.log("SHUFFLE!"),this._shuffleCount--,this.gameMechanicsManager.requestShuffle()))},_endGame:function(e){cc.director.loadScene("EndMenu",function(){cc.systemEvent.emit("result-passed",e)})},_checkBoostersState:function(){var e=this;this.boosterManager.boosters.forEach(function(t){t.setIsEnabled(e.scoreManager.getCurrentScore()>=t.getPrice())})},onDestroy:function(){this.node.off(cc.Node.EventType.TOUCH_START,this.onGridTouch,this)}}),cc._RF.pop()},{"./BoosterManager":"BoosterManager","./EffectsManager":"EffectsManager","./EndMenuManager":"EndMenuManager","./GameMechanicsManager":"GameMechanicsManager","./GameParameters":"GameParameters","./ScoreManager":"ScoreManager"}],GameMechanicsManager:[function(e,t,o){"use strict";cc._RF.push(t,"4738a9DVFRLLbLSXTzs4gke","GameMechanicsManager"),o.__esModule=!0,o.default=void 0;var i=r(e("./GameParameters")),s=r(e("./ScoreManager")),n=r(e("./Field")),a=r(e("./BoosterManager"));function r(e){return e&&e.__esModule?e:{default:e}}var l=cc.Class({extends:cc.Component,properties:{scoreManager:{default:null,type:s.default},boosterManager:{default:null,type:a.default},field:{default:null,type:n.default},_shuffleRequired:!1},start:function(){this._shuffleIfNeeded()},update:function(){1==this._shuffleRequired&&(this.field.hasMovingTiles()||(this._shuffleRequired=!1,this._shuffle()))},onClick:function(e){var t=this.field.getTileIndicesFromCoords(e);return!!t&&this._onTileClick(t.col,t.row)},checkLocationIsInField:function(e){return null!=this.field.getTileIndicesFromCoords(e)},hasPossibleMoves:function(){for(var e=0;e<i.default.columns;e++)for(var t=0;t<i.default.rows;t++)if(this._getTileNeighboursOfSameColor(e,t,this.field.getTileColor(e,t)).length>=i.default.minTilesToBlast)return!0;return!1},canHavePossibleMoves:function(){for(var e={},t=0;t<i.default.columns;t++)for(var o=0;o<i.default.rows;o++){var s=this.field.getTileColor(t,o);if(e[s]){if(e[s]++,e[s]>=i.default.minTilesToBlast)return!0}else e[s]=1}return!1},requestShuffle:function(){this._shuffleRequired=!0},_onTileClick:function(e,t){if(this.field.isTileMoving(e,t))return!1;var o=this.field.getTileColor(e,t),s=this._getTileNeighboursOfSameColor(e,t,o);return s.length>=i.default.minTilesToBlast&&(this.field.blastTiles(s),this.scoreManager.onBlast(s.length),!0)},_getTileNeighboursOfSameColor:function(e,t,o){var i=this,s=[{col:e,row:t}];return function e(t,o,n){i._findTileNeighbours(t,o).forEach(function(t){var o=i.field.getTileColor(t.col,t.row),a=s.some(function(e){return e.col==t.col&&e.row==t.row});o.toRGBValue()!=n.toRGBValue()||a||(s.push(t),e(t.col,t.row,n))})}(e,t,o),s},_shuffle:function(){for(var e=this.field.getTiles(),t=e.length-1;t>0;t--){var o=Math.floor(Math.random()*(t+1)),i=[e[o],e[t]];e[t]=i[0],e[o]=i[1]}this.field.setTiles(e),this._shuffleIfNeeded()},_shuffleIfNeeded:function(){this.hasPossibleMoves()||this._shuffle()},_findTileNeighbours:function(e,t){var o=[];return e>0&&o.push({col:e-1,row:t}),e<i.default.columns-1&&o.push({col:e+1,row:t}),t>0&&o.push({col:e,row:t-1}),t<i.default.rows-1&&o.push({col:e,row:t+1}),o}});o.default=l,t.exports=o.default,cc._RF.pop()},{"./BoosterManager":"BoosterManager","./Field":"Field","./GameParameters":"GameParameters","./ScoreManager":"ScoreManager"}],GameParameters:[function(e,t,o){"use strict";cc._RF.push(t,"73ccfiobLJEmKGqqjSCuVmK","GameParameters"),o.__esModule=!0,o.default=void 0;var i=function(){};o.default=i,i.columns=12,i.rows=12,i.minTilesToBlast=2,i.shuffleCount=1,i.startMovesCount=20,i.targetPoints=3e3,i.bombRadius=2,i.tileSize={width:171,height:192},i.tileMoveSpeed=3500,i.bounceSpeedRatio=.25,t.exports=o.default,cc._RF.pop()},{}],GameRules:[function(e,t,o){"use strict";cc._RF.push(t,"1c8edP4p1dCQIJcdFpgUbGa","GameRules"),o.__esModule=!0,o.default=void 0;var i=cc._decorator,s=(i.ccclass,i.property,cc.Class({}));o.default=s,t.exports=o.default,cc._RF.pop()},{}],ScoreManager:[function(e,t,o){"use strict";cc._RF.push(t,"1910dST5DlLU6gBvJPuexKf","ScoreManager"),o.__esModule=!0,o.default=void 0;var i,s=(i=e("./GameParameters"))&&i.__esModule?i:{default:i},n=cc.Class({extends:cc.Component,properties:{scoreLabel:{default:null,type:cc.Label},_score:0},onLoad:function(){this.scoreLabel.string=this._score+" / "+s.default.targetPoints},onBlast:function(e){var t=5*Math.pow(e,2)-15*e+30;this._score+=t,this._updateLabel()},addScore:function(e){this._score+=e,this._updateLabel()},getCurrentScore:function(){return this._score},_updateLabel:function(){this.scoreLabel.string=this._score+" / "+s.default.targetPoints}});o.default=n,t.exports=o.default,cc._RF.pop()},{"./GameParameters":"GameParameters"}],StartMenuManager:[function(e,t){"use strict";cc._RF.push(t,"a385bQ9VJBNKJhL/92IUqSj","StartMenuManager"),cc.Class({extends:cc.Component,properties:{startButton:{default:null,type:cc.Button}},onStartButton:function(){cc.director.loadScene("Game")}}),cc._RF.pop()},{}],TileFabric:[function(e,t,o){"use strict";cc._RF.push(t,"ae1c5nP3btGsYCc6oG8GOPC","TileFabric"),o.__esModule=!0,o.default=void 0;var i,s=(i=e("./Tile"))&&i.__esModule?i:{default:i},n=cc.Class({extends:cc.Component,properties:{prefabTiles:{default:[],type:[cc.Node]},tileCounter:0},create:function(){var e=cc.instantiate(this.prefabTiles[Math.floor(Math.random()*this.prefabTiles.length)]),t=e.getComponent(s.default);return t.sprite=e.getComponent(cc.Sprite),t.color=e.getComponent(s.default).color,t.index=this.tileCounter,this.tileCounter++,e}});o.default=n,t.exports=o.default,cc._RF.pop()},{"./Tile":"Tile"}],Tile:[function(e,t,o){"use strict";cc._RF.push(t,"f6847c4IvFJ84ivIJuw7hn6","Tile"),o.__esModule=!0,o.default=void 0;var i=n(e("./GameParameters")),s=n(e("./EffectsManager"));function n(e){return e&&e.__esModule?e:{default:e}}var a=Object.freeze({MOVING:0,BOUNCING_START:1,BOUNCING_FINISH:2,IDLE:3}),r=cc.Class({extends:cc.Component,properties:{sprite:{default:null,type:cc.Sprite},color:cc.Color.TRANSPARENT,effectsManager:{default:null,type:s.default},moveDelay:0,index:-1,_targetPosition:new cc.Vec3(-1,-1),_moveState:a.IDLE},_moveToTargetPos:function(e){var t=this._targetPosition.sub(this.node.position),o=i.default.tileMoveSpeed*e;this._moveState!=a.MOVING&&(o*=i.default.bounceSpeedRatio);var s=t.normalize(),n=s.mul(o);if(o<t.len())this.node.setPosition(this.node.position.add(n));else switch(this.node.setPosition(this._targetPosition),this._moveState){case a.IDLE:break;case a.MOVING:this._moveState=a.IDLE;break;case a.BOUNCING_START:this._moveState=a.BOUNCING_FINISH,this._targetPosition.subSelf(s.mul(.25*i.default.tileSize.height));break;case a.BOUNCING_FINISH:this._moveState=a.IDLE}},update:function(e){this.moveDelay>0?this.moveDelay-=e:this._moveState!=a.IDLE&&this._moveToTargetPos(e)},moveTo:function(e){var t=this._targetPosition.fuzzyEquals(e,.1),o=this.node.position.fuzzyEquals(e,.1);t&&(o||this._moveState!=a.IDLE)||(this._targetPosition=e,this._moveState=a.MOVING)},blast:function(){this.node.destroy();var e=new cc.Vec3(this.node.width/2,this.node.height/2),t=this.node.convertToWorldSpaceAR(e);this.effectsManager.animateBlast(t,this.color)},setInfo:function(){tile.sprite=tileNode.getComponent(cc.Sprite),tile.color=tileNode.getComponent(Tile).color},isTileMoving:function(){return this._moveState!=a.IDLE}});o.default=r,t.exports=o.default,cc._RF.pop()},{"./EffectsManager":"EffectsManager","./GameParameters":"GameParameters"}]},{},["Booster","BoosterManager","EffectsManager","EndMenuManager","Field","FieldColumn","GameManager","GameMechanicsManager","GameParameters","GameRules","ScoreManager","StartMenuManager","Tile","TileFabric"]);